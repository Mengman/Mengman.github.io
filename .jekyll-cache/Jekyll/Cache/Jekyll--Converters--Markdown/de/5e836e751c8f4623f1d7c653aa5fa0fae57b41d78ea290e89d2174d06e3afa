I"°<h2 id="softmaxå‡½æ•°">Softmaxå‡½æ•°</h2>
<p>Softmaxå‡½æ•°æ˜¯åœ¨æœºå™¨å­¦ä¹ åšåˆ†ç±»é¢„æµ‹ä¸­ä¸€ä¸ªé‡è¦çš„å·¥å…·å‡½æ•°ã€‚Softmaxå‡½æ•°çš„æ•°å­¦å®šä¹‰å¦‚ä¸‹ï¼š</p>

<p>[\sigma(z)<em>j = \frac{e^{z_j}}{\sum</em>{k=1}^Ne^{z_k}} 
\text{ for }j = 1, â€¦, N  \text{ and } \mathbf{z} = (z_1, z_2, â€¦, z_k)]</p>

<p>å¦‚æœç”¨ç¥ç»ç½‘ç»œåšä¸€ä¸ªåˆ†ç±»æ‰‹å†™æ•°å­—é¢„æµ‹ï¼Œé‚£ä¹ˆç¥ç»ç½‘ç»œçš„æœ€åä¸€å±‚æœ‰10ä¸ªè¾“å‡ºï¼Œåˆ†åˆ«ä½œä¸ºé¢„æµ‹ä¸º 0 ~ 9 çš„æ¦‚ç‡ã€‚é‚£ä¹ˆæ€ä¹ˆåˆ¤æ–­é¢„æµ‹ç»“æœåˆ°åº•æ˜¯å“ªä¸ªæ•°å­—å‘¢ï¼Ÿ ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯æ‰¾åˆ°10ä¸ªè¾“å‡ºé‡Œæœ€å¤§çš„é‚£ä¸ªä½œä¸ºé¢„æµ‹ç»“æœã€‚ ä½†æ˜¯è¿™10ä¸ªè¾“å‡ºæ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå…¶å’Œä¸ç­‰äº1ã€‚æ‰€ä»¥ä¸€ä¸ªæ›´å¥½çš„åŠæ³•æ˜¯å°†æ‰€æœ‰çš„è¾“å‡ºçš„å’Œç¼©æ”¾åˆ°1ï¼Œç„¶åçœ‹æ¯ä¸ªè¾“å‡ºå çš„æ¯”é‡ï¼Œå°†è¿™ä¸ªå€¼ä½œä¸ºé¢„æµ‹æ¦‚ç‡ï¼Œè€Œ Softmax å‡½æ•°æ°å¥½å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚å¯¹äºåˆ†ç±»  i  çš„é¢„æµ‹æ¦‚ç‡ä¸º  \(p_i =\sigma(z)_i\)</p>

<p>Softmax å‡½æ•°éå¸¸å¥½å®ç°ï¼Œä¸‹é¢æ˜¯ç”¨ numpy å®ç°çš„ Softmax</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">softmax</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">exps</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">exps</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">exps</span><span class="p">)</span>
</code></pre></div></div>
<p>åœ¨å®ç° Softmax å‡½æ•°çš„æ—¶å€™ï¼Œç”±äºæ¶‰åŠåˆ°æŒ‡æ•°è¿ç®—ï¼Œåœ¨è¾“å‡ºæ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œéå¸¸å®¹æ˜“é€ æˆç»“æœæº¢å‡ºã€‚
ä¸ºäº†ä½¿å¾— softmax å‡½æ•°åœ¨æ•°å€¼ä¸Šæ›´åŠ ç¨³å®šï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå¯¹ $\mathbf{z}$ è¿›è¡Œ normalization ã€‚ Normalization é™¤äº†ç»Ÿè®¡å­¦ä¸Šçš„<code class="language-plaintext highlighter-rouge">æ ‡å‡†åˆ†</code>( \(\frac{\mathbf{X} - \mu}{\sigma}\) ) , æœºå™¨å­¦ä¹ ä¸­è¿˜å¸¸ç”¨ä¸‰ç§å…¶ä»–çš„æ–¹æ³•ï¼š L1, L2 å’Œ max</p>

<p>L1: \(\frac{\mathbf{z}}{\sum_{i=1}^n{\vert z_i \vert }}\)</p>

<p>L2:  \(\frac{\mathbf{z}}{\sqrt{\sum_{i=1}^n{z_i^2}}}\)</p>

<p>max: \(\frac{\mathbf{z}}{\max{\mathbf{z}}}\)</p>

<p>äºæ˜¯å¯ä»¥æŠŠä¸Šé¢çš„ä»£ç æ”¹å†™ä¸º</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">stable_softmax</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">exps</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="n">np</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">exps</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">exps</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="softmax-æ±‚å¯¼">Softmax æ±‚å¯¼</h2>
<p>ç”±äº softmax çš„è‰¯å¥½æ€§è´¨ï¼Œåœ¨ç”¨ç¥ç»ç½‘ç»œåšåˆ†ç±»ä»»åŠ¡æ—¶ï¼Œé€šå¸¸ç›´æ¥å°†æœ€åä¸€å±‚è®¾ç½®ä¸º softmax, è¿™ä¸ªæ—¶å€™å°±è¦è€ƒè™‘å¦‚ä½•å¯¹ softmax è¿›è¡Œæ±‚å¯¼ã€‚ç¥ç»ç½‘ç»œè¾“å‡º $\mathbf{z}$ é•¿åº¦ä¸º k ï¼Œé‚£ä¹ˆè¦å¯¹è¿™ä¸ª k ä¸ªè¾“å‡ºè¿›è¡Œæ±‚åå¯¼ã€‚</p>

<p>[\frac{\partial\sigma(\mathbf{z})}{\partial\mathbf{z}} = 
  \begin{bmatrix}
      \frac{\partial\sigma(z)_0}{\partial z_0} &amp; \frac{\partial\sigma(z)_1}{\partial z_0} &amp; â€¦ &amp; \frac{\partial\sigma(z)_N}{\partial z_0} <br />
      \frac{\partial\sigma(z)_0}{\partial z_1} &amp; \frac{\partial\sigma(z)_1}{\partial z_1} &amp; â€¦ &amp; \frac{\partial\sigma(z)_N}{\partial z_1} <br />
      â€¦ <br />
      \frac{\partial\sigma(z)_0}{\partial z_N} &amp; \frac{\partial\sigma(z)_1}{\partial z_N} &amp; â€¦ &amp; \frac{\partial\sigma(z)_N}{\partial z_N} <br />
  \end{bmatrix}]</p>

<p>å¯¹äºçŸ©é˜µä¸­çš„å…ƒç´   \(\frac{\partial\sigma(z)_i}{\partial z_j}\) ï¼Œ å¦‚æœ  \(i \neq j\)  :</p>

<p>[\begin{aligned} \frac{\partial\frac{e^{z_i}}{\sum_{k=1}^Ne^{z_k}} }{\partial z^j} &amp; = \frac{0 - e^{z_i} e^{z_j}}{ (\sum_{k=1}^Ne^{z_k})^2 } <br />
&amp; = \frac{-e^{z_i}}{\sum_{k=1}^Ne^{z_k}} \times \frac{e^{z_j}}{\sum_{k=1}^Ne^{z_k}} <br />
&amp; = -p_i \times p_j\end{aligned}]</p>

<p>å¦‚æœ i = j :</p>

<p>[\begin{aligned}\frac{\partial\frac{e^{z_i}}{\sum_{k=1}^Ne^{z_k}} }{\partial z^i} &amp;= \frac{ e^{z_i} }{ \sum_{k=1}^Ne^{z_k} } - \frac{ e^{2z_i} }{ (\sum_{k=1}^Ne^{z_k})^2 } <br />
&amp; = \frac{ e^{z_i} (\sum_{k=1}^Ne^k - e^{z_i}) }{ (\sum_{k=1}^Ne^{z_k})^2 } <br />
&amp; = p_i (1-p_i)
\end{aligned}]</p>

<p>æ±‚å¯¼çŸ©é˜µå¯ä»¥æ”¹å†™ä¸ºï¼š</p>

<p>[\frac{\partial\sigma(\mathbf{z})}{\partial\mathbf{z}} = 
  \begin{bmatrix}
      p_0(1-p_0) &amp; -p_1 \times p_0 &amp; â€¦ &amp; - p_N * p_0 <br />
      -p_0 \times p_1 &amp; p_1(1-p_1) &amp; â€¦ &amp; - p_N * p_1 <br />
      â€¦ <br />
      -p_0 \times p_N &amp; -p_1 \times p_N &amp; â€¦ &amp;  p_N(1-p_N) <br />
\end{bmatrix}]</p>

<h2 id="äº¤å‰ç†µ">äº¤å‰ç†µ</h2>
:ET